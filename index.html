<!DOCTYPE html>
<html lang="en">
<head>
  <meta keyset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giải phương trình vi phân tuyến tính cấp 1</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="all.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css" rel="stylesheet">
</head>
<body>
  <div class="app">
    <div class="solution">
      <div class="solution__header">PHƯƠNG TRÌNH VI PHÂN TUYẾN TÍNH CẤP 1</div>
      <div class="solution__ques">
        <p>\( y'\:+ \)</p>
        <div class="solution__p-box">
          <input class="solution__p-input" placeholder="P(x)" onfocus="inputSelected(this)">
        </div>
        <p>\( \times y\: = \)</p>
        <div class="solution__q-box">
          <input class="solution__q-input" placeholder="Q(x)" onfocus="inputSelected(this)"></input>
        </div>
        <button class="run" onclick="solve()">Giải</button>
      </div>
      <div class="solution__ans">
        <div class="step-1"></div>
        <div class="step-2"></div>
        <div class="step-3"></div> 
        <div class="step-4"></div>
        <div class="step-5"></div>
      </div>
    </div>                    
    </div>
  </div>
</body>
<style>
  .solution__header {
    padding-top: 20px;
    display: flex;
    justify-content: center;
  }
  .solution__ques {
    padding-top: 20px;
    display: flex;
    justify-content: center;
  }
  .solution__ques > div {
    display: flex;
    width: 50px;
    margin: 0 5px 0 5px;
  }
  .solution__ques > div > input {
    width: 100%;
    border: 1px solid #6e6e6e;
    border-radius: 5px;
    cursor: pointer;
  }
  .solution__ques > div > input.selected {
    border: 2px solid #000;
  }
  .solution__ans {
    display: grid;
    width: 100%;
    justify-content: center;
    gap: 15px;
    margin-top: 30px;
    font-size: 20px;
  }
</style>
<script>

var pInput = document.querySelector(".solution__p-input");
var qInput = document.querySelector(".solution__q-input");
var solutionAns = document.querySelector(".solution__ans");
var step_1 = document.querySelector(".step-1");
var step_2 = document.querySelector(".step-2");
var step_3 = document.querySelector(".step-3");
var step_4 = document.querySelector(".step-4");
var step_5 = document.querySelector(".step-5");

function inputSelected(input) {
  if (qInput.getAttribute("class") == "solution__q-input"
    && pInput.getAttribute("class") == "solution__p-input") {
    input.classList.toggle("selected");
  }else {
    pInput.classList.toggle("selected");
    qInput.classList.toggle("selected");
  }
};

function solve() {
  step_1.innerHTML = "";
  step_2.innerHTML = "";
  step_3.innerHTML = "";
  step_4.innerHTML = "";
  step_5.innerHTML = "";
  pText = pInput.value;
  qText = qInput.value;
  
  var pInte = nerdamer(`integrate(${pText}, x)`).text();
  var eExpP = nerdamer(`simplify(exp(${pInte}))`).text(); // Thêm dấu ngoặc nhọn quanh pInte
  var rightStep2 = nerdamer(`simplify(${qText}*exp(${pInte}))`).text();
  var rightStep2Inte = nerdamer(`integrate(${rightStep2}, x)`).text();
  var partOfStep5 = nerdamer(`simplify(${rightStep2Inte}/(exp(${pInte})))`).text();
  var partCOfStep5 = nerdamer(`simplify(exp(-${pInte}))`).text();

  
  var pTextLa = nerdamer.convertToLaTeX(pInte);
  var qTextLa = nerdamer.convertToLaTeX(qText);
  var pInteLa = nerdamer.convertToLaTeX(pInte);
  var rightStep2La = fixDoubleExponent(nerdamer.convertToLaTeX(rightStep2));
  
  var rightStep2InteLa = fixDoubleExponent(nerdamer.convertToLaTeX(rightStep2Inte));
  var partOfStep5La = fixDoubleExponent(nerdamer.convertToLaTeX(partOfStep5));
  var partCOfStep5La = nerdamer.convertToLaTeX(partCOfStep5);

  step_1.innerHTML += "Lấy: ";
  step_1.innerHTML += `\\( e^{\\int P(x)dx} \\ = \\ \\)`;
  
  step_1.innerHTML += `\\( e^{${pInte}} \\)`;
  step_1.innerHTML += `\\( \\ = \\ e^{${pInte}} \\)`;
  
  step_2.innerHTML += "Nhân cả 2 vế cho ";
  step_2.innerHTML += "\\( e^{\\int P(x)dx}: \\ \\)";
  step_2.innerHTML += `\\( y' . e^{${pInte}} \\ + (${pTextLa} . e^{${pInte}}) . y \\ = \\ ${qTextLa}.e^{${pInte}} \\)`; 
  
  step_3.innerHTML += "Hay: ";
  step_3.innerHTML += `\\( \\frac{d}{dx} \\)`;
  step_3.innerHTML += `\\( \\ (y.e^{${pInte}}) \\ = \\ \\)`;
  step_3.innerHTML += `\\( ${rightStep2La} \\)`;
  
  
  step_4.innerHTML += "Lấy tích phân 2 vế ta được: ";
  step_4.innerHTML += `\\( y.e^{${pInte}} \\ = ${rightStep2 == "0" ? "" : `\\int ${rightStep2La} dx + C \\ = `} \\)`;
  step_4.innerHTML += `\\( \\ ${rightStep2 == "0" ? "" : `${rightStep2InteLa} +`} C \\)`;

  step_5.innerHTML += "Vậy nghiệm tổng quát của phương trình là: ";
  step_5.innerHTML += `\\( y \\ = \\ ${rightStep2 == "0" ? "" : `${partOfStep5La} +`}  C. \\)`;
  step_5.innerHTML += `\\( ${partCOfStep5La} \\)`;
  
  MathJax.typesetPromise([solutionAns]);
}
function fixDoubleExponent(expression) {
  return expression.replace(/{e}\^{([^}]+)}\^([^\{]+)/g, (match, base, exponent) => {
    return `e^{${base}^${exponent}}`;
  });
}

</script>
</html>
